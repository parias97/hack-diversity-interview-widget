{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\peter\\\\OneDrive\\\\Desktop\\\\Drift-Widget\\\\hack-diversity-interview-widget\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"C:\\\\Users\\\\peter\\\\OneDrive\\\\Desktop\\\\Drift-Widget\\\\hack-diversity-interview-widget\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _inherits from \"C:\\\\Users\\\\peter\\\\OneDrive\\\\Desktop\\\\Drift-Widget\\\\hack-diversity-interview-widget\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\peter\\\\OneDrive\\\\Desktop\\\\Drift-Widget\\\\hack-diversity-interview-widget\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\peter\\\\OneDrive\\\\Desktop\\\\Drift-Widget\\\\hack-diversity-interview-widget\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _wrapNativeSuper from \"C:\\\\Users\\\\peter\\\\OneDrive\\\\Desktop\\\\Drift-Widget\\\\hack-diversity-interview-widget\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/wrapNativeSuper\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\n/**************************************************\r\n*************** DO NOT EDIT THIS FILE *************\r\n**************************************************/\nvar MessageValidationError = /*#__PURE__*/function (_Error) {\n  _inherits(MessageValidationError, _Error);\n\n  var _super = _createSuper(MessageValidationError);\n\n  function MessageValidationError() {\n    var _this;\n\n    _classCallCheck(this, MessageValidationError);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.name = 'MessageValidationError';\n    return _this;\n  }\n\n  return MessageValidationError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n\nvar InternalServerError = /*#__PURE__*/function (_Error2) {\n  _inherits(InternalServerError, _Error2);\n\n  var _super2 = _createSuper(InternalServerError);\n\n  function InternalServerError() {\n    var _this2;\n\n    _classCallCheck(this, InternalServerError);\n\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    _this2 = _super2.call.apply(_super2, [this].concat(args));\n    _this2.name = 'InternalServerError';\n    return _this2;\n  }\n\n  return InternalServerError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n\nvar getFuzzyServerResponseDelay = function getFuzzyServerResponseDelay() {\n  var min = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 100;\n  var max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2000;\n  return Math.max(min, Math.min(Math.round(Math.random() * Math.random() * 1300), max));\n};\n\nvar authorId = Math.round(Math.random() * Math.random() * 100000);\nvar messageId = 0;\n\nvar createServerMessage = function createServerMessage(_ref) {\n  var message = _ref.message;\n  return _objectSpread({}, message, {\n    authorId: authorId,\n    createdAt: Date.now(),\n    id: ++messageId\n  });\n};\n\nvar getValidationError = function getValidationError(message) {\n  // only allow certain keys\n  var allowedKeys = new Set(['body', 'createdAt', 'context', 'id', 'authorId', 'attributes', 'conversationId']);\n  var givenKeys = new Set(Object.keys(message));\n  allowedKeys.forEach(function (key) {\n    return givenKeys.delete(key);\n  });\n\n  if (givenKeys.size) {\n    var invalidKeys = [];\n    givenKeys.forEach(function (invalidKey) {\n      return invalidKeys.push(invalidKey);\n    });\n    return new MessageValidationError(\"The keys [\".concat(invalidKeys.join(', '), \"] are not allowed to appear on a message\"));\n  } // require a body\n\n\n  if (!message.body) {\n    return new MessageValidationError('A message must have a \"body\"');\n  }\n};\n\nexport default {\n  sendMessage: function sendMessage(message) {\n    var response = new Promise(function (res, rej) {\n      var serverMessage = createServerMessage({\n        message: message\n      });\n      var apiSuccess = Math.random() > 0.1;\n      var validationError = getValidationError(message);\n\n      if (apiSuccess && !validationError) {\n        setTimeout(res.bind(null, {\n          messageFromServer: serverMessage\n        }), getFuzzyServerResponseDelay());\n      } else {\n        if (validationError) {\n          setTimeout(rej.bind(null, {\n            messageFromServer: serverMessage,\n            error: validationError\n          }), getFuzzyServerResponseDelay());\n        } else {\n          setTimeout(rej.bind(null, {\n            messageFromServer: serverMessage,\n            error: new InternalServerError(\"Server gave a 500\")\n          }), getFuzzyServerResponseDelay());\n        }\n      }\n    });\n    return response;\n  }\n};","map":{"version":3,"sources":["C:/Users/peter/OneDrive/Desktop/Drift-Widget/hack-diversity-interview-widget/src/modules/message/api.js"],"names":["MessageValidationError","name","Error","InternalServerError","getFuzzyServerResponseDelay","min","max","Math","round","random","authorId","messageId","createServerMessage","message","createdAt","Date","now","id","getValidationError","allowedKeys","Set","givenKeys","Object","keys","forEach","key","delete","size","invalidKeys","invalidKey","push","join","body","sendMessage","response","Promise","res","rej","serverMessage","apiSuccess","validationError","setTimeout","bind","messageFromServer","error"],"mappings":"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","sourcesContent":["\r\n/**************************************************\r\n*************** DO NOT EDIT THIS FILE *************\r\n**************************************************/\r\n\r\nclass MessageValidationError extends Error {\r\n  name = 'MessageValidationError'\r\n}\r\nclass InternalServerError extends Error {\r\n  name = 'InternalServerError'\r\n}\r\n\r\nconst getFuzzyServerResponseDelay = (min = 100, max = 2000) => (\r\n  Math.max(\r\n    min,\r\n    Math.min(\r\n      Math.round(Math.random() * Math.random() * 1300),\r\n      max\r\n    )\r\n  )\r\n);\r\n\r\nconst authorId = Math.round(Math.random() * Math.random() * 100000);\r\nlet messageId = 0;\r\n\r\nconst createServerMessage = ({ message }) => ({\r\n  ...message,\r\n  authorId,\r\n  createdAt: Date.now(),\r\n  id: ++messageId,\r\n});\r\n\r\nconst getValidationError = (message) => {\r\n\r\n  // only allow certain keys\r\n  const allowedKeys = new Set(['body', 'createdAt', 'context', 'id', 'authorId', 'attributes', 'conversationId']);\r\n  const givenKeys = new Set(Object.keys(message));\r\n  allowedKeys.forEach(key => givenKeys.delete(key))\r\n  if (givenKeys.size) {\r\n    const invalidKeys = [];\r\n    givenKeys.forEach(invalidKey => invalidKeys.push(invalidKey));\r\n    return new MessageValidationError(`The keys [${invalidKeys.join(', ')}] are not allowed to appear on a message`);\r\n  }\r\n\r\n  // require a body\r\n  if (!message.body) {\r\n    return new MessageValidationError('A message must have a \"body\"');\r\n  }\r\n}\r\n\r\nexport default {\r\n  sendMessage: (message) => {\r\n    const response = new Promise((res, rej) => {\r\n      const serverMessage = createServerMessage({ message });\r\n      const apiSuccess = Math.random() > 0.1;\r\n      const validationError = getValidationError(message);\r\n      if (apiSuccess && !validationError) {\r\n        setTimeout(res.bind(null, { messageFromServer: serverMessage }), getFuzzyServerResponseDelay());\r\n      } else {\r\n        if (validationError) {\r\n          setTimeout(rej.bind(null, { messageFromServer: serverMessage, error: validationError }), getFuzzyServerResponseDelay());\r\n        } else {\r\n          setTimeout(rej.bind(null, { messageFromServer: serverMessage, error: new InternalServerError(\"Server gave a 500\") }), getFuzzyServerResponseDelay());\r\n        }\r\n      }\r\n    });\r\n    return response;\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}